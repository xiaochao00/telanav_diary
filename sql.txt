关闭 postgres 数据库连接
SELECT pg_terminate_backend(pid) FROM pg_stat_activity WHERE datname='UniDB_HERE_NA17Q1_1.0.0.477938-20170207020603-RC' and pid<>pg_backend_pid();

移动数据库 表空间
ALTER DATABASE {database} SET tablespace {tablespace};
ALTER DATABASE "HERE_NA17Q2" SET tablespace ssd1;

查看所有表空间
select spcname, pg_tablespace_location(oid) from pg_tablespace;
查看默认表空间目录
show data_directory;


查询所有数据库 
SELECT datname FROM pg_database;

查询所有schema

COPY
psql -U postgres -d tollcost -c "COPY (SELECT ...) TO '/tmp/a.txt' WITH CSV DELIMITER '`' "
psql -U postgres -d tollcost -c "copy public.mapping from E'C:\\Windows\\System32\\dump_mapping_20180413.csv'  delimiter '`' csv header encoding 'utf8' "



查询数据库和tablespace对应关系
SELECT d.datname as "Name",
r.rolname as "Owner",
pg_catalog.pg_encoding_to_char(d.encoding) as "Encoding",
pg_catalog.shobj_description(d.oid, 'pg_database') as "Description",
t.spcname as "Tablespace"
FROM pg_catalog.pg_database d
JOIN pg_catalog.pg_roles r ON d.datdba = r.oid
JOIN pg_catalog.pg_tablespace t on d.dattablespace = t.oid
ORDER BY 1;


备份数据库表结构
pg_dump -d geo_analyse -U postgres -s > geo_analyse_DB_back.sql
-s 只备份表结构
psql -d geo_analyse -U postgres -c " COPY(SELECT * FROM analyse_city WHERE region='CN') TO  '/tmp/cn_analyse_city.sql' "

还原数据库
createdb newDBname
psql -d newDBname -U postgres -f dump.sql

还原表数据
psql -U postgres -d geo_analyse -c " COPY analyse_city FROM '/home/mapuser/workspace_users/web_tool/geo_analysis/cn_analyse_city.sql'"
